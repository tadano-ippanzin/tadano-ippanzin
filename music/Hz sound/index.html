<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>周波数指定トーンジェネレーター</title>
    <style>
        :root { --primary: #4a90e2; --bg: #f5f7fa; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        h1 { font-size: 1.25rem; color: #333; margin-bottom: 1.5rem; text-align: center; }
        .input-group { margin-bottom: 1.2rem; }
        label { display: block; font-size: 0.85rem; color: #666; margin-bottom: 0.5rem; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; box-sizing: border-box; transition: border-color 0.2s; }
        input:focus { border-color: var(--primary); outline: none; }
        .btn-play { width: 100%; padding: 12px; background-color: var(--primary); color: white; border: none; border-radius: 6px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: background 0.2s; }
        .btn-play:hover { background-color: #357abd; }
        .btn-play:active { transform: scale(0.98); }
        .status { margin-top: 1rem; text-align: center; font-size: 0.9rem; color: #888; height: 1.2rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>トーンジェネレーター</h1>
    
    <div class="input-group">
        <label>周波数 (Hz) - 例: 440 (ラ), 880 (高いラ)</label>
        <input type="number" id="freq" value="440" min="20" max="20000">
    </div>

    <div class="input-group">
        <label>再生時間 (秒)</label>
        <input type="number" id="duration" value="1.0" step="0.1" min="0.1">
    </div>

    <div class="input-group">
        <label>波形の種類</label>
        <select id="type">
            <option value="sine">サイン波 (柔らかい)</option>
            <option value="square">矩形波 (電子音)</option>
            <option value="sawtooth">のこぎり波 (鋭い)</option>
            <option value="triangle">三角波 (こもった音)</option>
        </select>
    </div>

    <button class="btn-play" onclick="playTone()">音を鳴らす</button>
    <div id="status" class="status"></div>
</div>

<script>
    let audioCtx = null;

    function playTone() {
        // AudioContextの初期化
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        const freq = parseFloat(document.getElementById('freq').value);
        const duration = parseFloat(document.getElementById('duration').value);
        const type = document.getElementById('type').value;
        const status = document.getElementById('status');

        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();

        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);

        // --- エンベロープ（音量の制御） ---
        const now = audioCtx.currentTime;
        // 鳴り始めの「プツッ」を防ぐ（0.01秒でフェードイン）
        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(0.5, now + 0.01); 
        // 終わりの「プツッ」を防ぐ（0.05秒でフェードアウト）
        gain.gain.setValueAtTime(0.5, now + duration - 0.05);
        gain.gain.linearRampToValueAtTime(0, now + duration);

        osc.connect(gain);
        gain.connect(audioCtx.destination);

        osc.start();
        osc.stop(now + duration);

        // 状態表示
        status.innerText = "再生中...";
        setTimeout(() => {
            status.innerText = "";
        }, duration * 1000);
    }
</script>

</body>
</html>
