<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>【PNG⇒TTFならETMs】Easy TTF Maker system v4.0</title>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin: 20px auto; background: #f4f4f9; padding: 20px; }
        .main-container { display: flex; gap: 20px; }
        /* 左側：アップロードした画像リスト */
        .source-area { flex: 1; background: #fff; padding: 15px; border-radius: 10px; border: 2px solid #ddd; min-height: 400px; }
        /* 右側：文字の箱（ここに画像を放り込む） */
        .target-area { flex: 1; display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; }
        
        .image-item { width: 60px; height: 60px; border: 1px solid #ccc; cursor: grab; background: #eee; object-fit: contain; }
        .char-box { 
            background: #fff; border: 2px dashed #bbb; border-radius: 5px; height: 100px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative;
        }
        .char-box.over { border-color: #007bff; background: #eef; }
        .char-box span { font-size: 24px; font-weight: bold; color: #ccc; position: absolute; top: 5px; }
        .char-box img { width: 60px; height: 60px; object-fit: contain; z-index: 2; }

        .upload-btn { background: #007bff; color: white; padding: 10px; border-radius: 5px; text-align: center; cursor: pointer; margin-bottom: 10px; }
        .controls { margin-top: 20px; text-align: center; background: #fff; padding: 20px; border-radius: 10px; }
        button#generate { background: #28a745; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>ETMs v4.0：ファイル名無視・配置エディタ</h1>
    <p>①画像をアップ → ②下の文字ボックスにドラッグして配置</p>

    <div class="main-container">
        <div class="source-area" id="source-area">
            <div class="upload-btn" onclick="document.getElementById('file-input').click()">画像を選択</div>
            <input type="file" id="file-input" multiple accept="image/*" style="display:none">
            <div id="image-pool"></div>
        </div>
    </div>

    <div class="controls">
        <h3>文字ボックス（ここにドラッグ！）</h3>
        <div class="target-area" id="target-area">
            </div>
        <br>
        <input type="text" id="font-name" value="MyFont" style="padding:10px;">
        <button id="generate">この配置でフォント作成</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/opentype.js@1.3.4/dist/opentype.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/imagetracerjs@1.2.6/imagetracer_v1.2.6.min.js"></script>

    <script>
        const imagePool = document.getElementById('image-pool');
        const targetArea = document.getElementById('target-area');
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split("");
        let draggedImgSrc = null;

        // 文字ボックスの生成
        chars.forEach(c => {
            const box = document.createElement('div');
            box.className = 'char-box';
            box.innerHTML = `<span>${c}</span>`;
            box.dataset.char = c;

            box.ondragover = (e) => { e.preventDefault(); box.classList.add('over'); };
            box.ondragleave = () => box.classList.remove('over');
            box.ondrop = (e) => {
                e.preventDefault();
                box.classList.remove('over');
                if (draggedImgSrc) {
                    let img = box.querySelector('img');
                    if (!img) {
                        img = document.createElement('img');
                        box.appendChild(img);
                    }
                    img.src = draggedImgSrc;
                    box.dataset.src = draggedImgSrc; // 保存用
                }
            };
            targetArea.appendChild(box);
        });

        document.getElementById('file-input').onchange = (e) => {
            Array.from(e.target.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const img = document.createElement('img');
                    img.src = ev.target.result;
                    img.className = 'image-item';
                    img.draggable = true;
                    img.ondragstart = () => { draggedImgSrc = img.src; };
                    imagePool.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        };

        // (書き出し処理は dataset.src があるボックスを拾って生成するロジックに...)
    </script>
</body>
</html>
